<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>index</title>
<link rel="stylesheet" type="text/css" href="theme/1/css/common.css">
<link rel="stylesheet" type="text/css" href="theme/1/css/style.css">
<link rel="stylesheet" type="text/css" href="theme/1/css/EditingArea.css">
<link rel="stylesheet" type="te
xt/css" href="theme/1/css/table.css">
<link rel="stylesheet" type="text/css" href="theme/1/css/icon.css">
<link rel="stylesheet" type="text/css" href="theme/1/css/zy.css">
</head>
<script type="text/javascript" src="jquery-2.1.4/jquery.min.js"></script>
<script type="text/javascript">
  $(function(){
    $(".baseUI li ul li").css("display","none");
    $(".baseUI em").parent().bind("click",function(){
      var li=$(this).siblings().children();
      li.slideDown();
      var lis=$(this).parent().siblings().children("ul").children();
      lis.slideUp();
     });
    $(".baseUI li ul li").click(function(){
      $(this).addClass("current").siblings().removeClass("current");
    });
	
	$(".baseUI li ul li:eq(0)").click(function(){
		$(".right").load("theme/1/load/index.html");
		})
	// $(".baseUI li ul:eq(0) li:eq(0)").trigger('click');
  $(".c_condition span:eq(4)").click(function(){
    $(".right").load("theme/1/load/addSubject.html");
  })
  }) 
</script>
<body>
<div class="main">
	<div id="top">
    	<div class="top">
        	<div class="tk_logo"></div>
            <div class="t_sign">
            	<span>你好，管理员</span><a href="#" class="t_exit">退出</a>
            </div>
            <div class="t_icon">
            	<ul>
                	<li><a href="#" class="t1"><span>桌面</span></a></li>
                    <li><a href="#" class="t2"><span>换肤</span></a></li>
                    <li><a href="#" class="t3"><span>关于</span></a></li>
              </ul>
            </div>
        </div>
    </div>
    <div id="cont">
    	<div class="centent">
        	<div class="left c_view">
            	<ul class="baseUI">
                	<li>  <a href="#"><em class="base_basicset"></em><span>题库</span></a>
                        <ul>
                            <li class="current"><a href="#">全部题目</a></li>
                            <li><a href="#">题目管理</a></li>
                        </ul>
                  </li>
                    <li><a href="#"><em class="base_userset"></em><span>试卷管理</span></a>
                        <ul>
                            <li><a href="#">试卷列表</a></li>
                            <li><a href="#">手工组卷</a></li>
                        </ul>
                    </li>
                    <li><a href="#"><em class="base_teachergroup"></em><span>考试管理</span></a>
                        <ul>
                            <li><a href="#">考试列表</a></li>
                            <li><a href="#">考试安排</a></li>
                        </ul>
                    </li>
                   
                </ul>
            </div>
      <div class="right">
        <div class="editingarea">
                    <div class="c_flex"><span class="c_flexible"></span></div>
                  <div class="c_editview">
                   <div class="c_condition">
                       <span><select><option>题干</option></select></span>
                       <span class="pl5 " ><input type="text"></span>
                       <span class="pl15 pr15 btn_gray ">查找</span>
                       <span class="icon_lead-in"><em class="icon_r">批量导入题目</em></span>
                       <span class="icon_add"><em class="icon_r">单个添加题目</em></span>
                    </div>
                    <div class="divtable">
                        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="tablea">
                            <tr hidden>
                                <td align="center">年份</td>
                                <td align="left">
                                    <div class="chose"><a href="javascript:void(0)" class="active3">全部</a><a href="javascript:void(0)">语文</a><a href="javascript:void(0)">数学</a><a href="javascript:void(0)">英语</a><a href="javascript:void(0)">政治</a></div>
                                </td>
                            </tr>
                        </table>
                    </div>
                       <div class="Catalog">
                           <div class="Catalog_right">
                               <div class="Catalogtitle">总计<em>15552</em>道题&nbsp;&nbsp;提示：单击体面可显示答案和解析&nbsp;&nbsp;<input type="checkbox" /><b>显示答案和解析</b>&nbsp;&nbsp;<a href="#" class="Thispage">本页全部试题加入试卷</a><div><i>1</i><a href="#" class="pageone">前</a><a href="#" class="pagetwo">后</a></div></div>
                               <div class="Catalog_rightnei"></div>
                               <div class="Catalog_rightnei" style="display:none">
                                    <div class="Catalogtitwo">题号：25544&nbsp;&nbsp;题型：还是得&nbsp;&nbsp;难度：订餐&nbsp;&nbsp;上传人：女性司机&nbsp;&nbsp;来源：才能使得&nbsp;&nbsp;上传时间:220255&nbsp;&nbsp;组卷次数：<em>0</em></div>
                                    <div class="Catalogcontent">
                                      <div class="Catalogcontentup">题型</div>
                                      <div class="Catalogcontentdown"><a href="javascript:void(0)">加入试卷</a>
                                      <a href="#">审核通过</a><a href="#">审核不通过</a><a href="#">删除题目</a></div></div>
                                    </div>
                               </div>
                           </div>
                           <div class="clear"></div>
                       </div>
                    </div>
                </div>
      </div>      
    <div id="foot"><a href="#">上海师悦信息科技有限公司</a></div>
</div>
</body>
<script>
  $(function(){


    $.getJSON('./exam/manager/getAllSubjectType',function(data){
    var tr = $(".divtable tr:hidden").clone().removeAttr("hidden");
    tr.find(".chose").html("");
    tr.children("td").eq(0).html("类型")
      data.forEach(function(item,index){   
    if(index == 0){
      tr.find(".chose").append("<a class='active3' href='javascript:void(0)' id="+item.id+">"+item.realName+"</a>")
    }else{
      tr.find(".chose").append("<a href='javascript:void(0)' id="+item.id+">"+item.realName+"</a>")
    };
  });
      $(".tablea").append(tr);
    });

 $.getJSON('./exam/manager/getAllTopics',function(data){
    var tr = $(".divtable tr:hidden").clone().removeAttr("hidden");
    tr.find(".chose").html("");
    tr.children("td").eq(0).html("课程");
      data.forEach(function(item,index){
     if(index == 0){
      tr.find(".chose").append("<a class='active3' href='javascript:void(0)' id="+item.id+">"+item.title+"</a>")
    }else{
      tr.find(".chose").append("<a href='javascript:void(0)' id="+item.id+">"+item.title+"</a>")
    }
     
       });
      $(".tablea").append(tr);
    })    
  


  $.getJSON('./exam/manager/getAllDepartmentes',function(data){
    var tr = $(".divtable tr:hidden").clone().removeAttr("hidden");
    tr.find(".chose").html("");
    tr.children("td").eq(0).html("方向");
      data.forEach(function(item,index){
    
     if(index == 0){
      tr.find(".chose").append("<a class='active3' href='javascript:void(0)' id="+item.id+">"+item.name+"</a>")
    }else{
      tr.find(".chose").append("<a href='javascript:void(0)' id="+item.id+">"+item.name+"</a>").removeClass("active3");
    }

       });
      $(".tablea").append(tr);
    })



    $.getJSON('./exam/manager/getSubjectLevel',function(data){
    var tr = $(".divtable tr:hidden").clone().removeAttr("hidden");
    tr.find(".chose").html("");
    tr.children("td").eq(0).html("级别");
      data.forEach(function(item,index){
    
     if(index == 0){
      tr.find(".chose").append("<a class='active3' href='javascript:void(0)' id="+item.id+">"+item.realName+"</a>")
    }else{
      tr.find(".chose").append("<a href='javascript:void(0)' id="+item.id+">"+item.realName+"</a>")
    }
     
       });
      $(".tablea").append(tr);
    })    
    

  // 查看所有题目，在页面上硬加载所有题目数据
  $.getJSON("./exam/manager/findSubject",function(data){
    $(".Catalogcontentup").empty();
    data.forEach(function(item,index){
      $('.Catalogcontentup').append(""+item.stem+","+item.uploadTime+"");
        })
  });


  //绑定点击事件
    var department_id ;
    var subjectLevel_id ;
    var subjectType_id ;
    var topic_id ;
    var subject_id
  $(".tablea").off("click");
  $(".tablea").on("click","a",function(){
    $(this).addClass("active3").siblings().removeClass("active3")
    var tr = $(".divtable tr:hidden").clone().removeAttr("hidden");
//找到点击的a标签的id值
    itemfn();
    var data = {
          department_id,
          subjectLevel_id,
          subjectType_id,
          topic_id
        }
    var url = "http://127.0.0.1:3000/exam/manager/selectSubject";
//往后台发送数据 post方法
//第一条url
    postFunction(url,data); 
  });

 //找到input:checkbox的checked属性 
 var checkbox = $(".Catalogtitle input:checkbox")[0];
        checkbox.onclick = function(){
           if(checkbox.checked){
  //调用itemfn()方法
            itemfn();
            var data = {
          department_id,
          subjectLevel_id,
          subjectType_id,
          topic_id
        }
//找到选项
    var url = "http://127.0.0.1:3000/exam/manager/selectSubject";
        $.post(url,data,function(datas){
          datas.forEach(function(item,index){
              alert("答案:"+item.analysis+"<br>"+"解析："+item.answer);
          });
        });
        }else{
          alert("没有选中题目");
        }
  }
//封装post方法
 var postFunction = function(url,data){
         $.post(url,data,function(datas){
          //添加前清除
                $(".Catalog_rightnei").empty();
                datas.forEach(function(item,index){
                var newTable = '<div class="Catalog_rightnei">'+
                                    '<div class="Catalogtitwo">题号：25544&nbsp;&nbsp;题型：还是得&nbsp;&nbsp;难度：订餐&nbsp;&nbsp;上传人：女性司机&nbsp;&nbsp;来源：才能使得&nbsp;&nbsp;上传时间:'+item.uploadTime+'+nbsp;&nbsp;组卷次数：<em>0</em></div>'+
                                    '<div class="Catalogcontent">'+
                                      '<div class="Catalogcontentup">'+item.stem+'<div class="Catalogcontentups"></div></div>'+
                                     
                                      '<div class="Catalogcontentdown"><a href="#">加入试卷</a><a href="#">审核通过</a><a href="#">审核不通过</a><a href="#">删除题目</a></div>'+
                                    '</div>'+
                               '</div>'+
                           '</div>';
//将该界面添加到指定的div中
                  $(".Catalog_rightnei").append(newTable);

                  subject_id = item.id;
                    var data = {
                      subject_id
                    }
                    $.post("http://127.0.0.1:3000/exam/manager/findChoice",data,function(datam){
                      var a = 65;
                        datam.forEach(function(item,index){
                          console.log("itttem:",item);
                          var newtable = "<div item = '"+item.correct.data[0]+"''>"+String.fromCharCode(a)+"."+item.content+"</div>";
                          var right = 
                          $(".Catalogcontentups").append(newtable);
                          a+= 1;
                        });
                        if($($(".Catalogtitle input:checkbox")[0]).checked){
                          
                        }else{}

                      })
                          })

                      });
                  }


//封装itemfn方法

var itemfn = function(){
    Array.prototype.slice.call($("a[class='active3']"),1).forEach(function(item){
    if($(item).parent().parent().parent().children("td").eq(0).html()=='类型'){
      subjectType_id = item.id;
      console.log(subjectType_id);//打印正确
    }else if($(item).parent().parent().parent().children("td").eq(0).html()=='课程'){
      topic_id = item.id;
      console.log(topic_id);//打印正确
    }else if($(item).parent().parent().parent().children("td").eq(0).html() =='方向'){
      department_id = item.id;
      console.log(department_id);//打印正确
    }else{
      subjectLevel_id = item.id;
      console.log(subjectLevel_id);//打印正确
    }
   })
 };

    
});
    
    
</script>
</html>
